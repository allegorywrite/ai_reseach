# Consensus-Based Control Barrier Function (CCBF)の概要

## 1. CCBFとは

Consensus-Based Control Barrier Function (CCBF)は、スウォームロボット制御のための新しいアプローチです。従来のControl Barrier Function (CBF)が個々のロボットの状態のみを制約するのに対し、CCBFは分散システム全体の状態を制約することができます。

論文「Consensus-Based Control Barrier Function for Swarm」（Manao Machida and Masumi Ichien）では、CCBFが以下の特徴を持つことが示されています：

1. **分散システム全体の状態制約**: 個々のロボットだけでなく、スウォーム全体の状態を安全集合内に保つことができる
2. **局所通信のみで実現**: ロボット間の局所的な通信のみを用いて、全体の状態を制約できる
3. **コンセンサスフィルタによる近似**: バリア関数の値をコンセンサスフィルタによって近似する

## 2. 通常のCBFとCCBFの違い

### 通常のCBF（従来研究）

従来のスウォームにおけるCBFの研究は、主に以下の目的に焦点を当てていました：
- ロボット間の衝突回避
- ロボット間の接続性維持

これらのCBFは、ロボット間の距離を制約し、各ロボットの局所的な状態（自身の状態と近くのロボットの状態）のみに依存します。そのため、スウォーム全体の状態を制約することはできません。

### CCBF（提案手法）

CCBFは、スウォーム全体の状態に依存するバリア関数を分散システムで使用する方法を提供します：

1. **全体状態への依存**: スウォーム全体の状態に依存するバリア関数を使用
2. **コンセンサスフィルタの活用**: 各ロボットがコンセンサスフィルタを用いて全体の状態を近似
3. **局所通信のみで実現**: 全体の状態を知ることなく、局所的な通信のみで制約を満たす制御入力を計算

## 3. CCBFの数学的定式化

### バリア関数の表現

CCBFでは、以下の形式のZeroing Barrier Function (ZBF)を考えます：

$$B(x) = \sum_{m \in M} \phi_m \left( \sum_{i \in R} \psi_{im}(x_i) \right)$$

ここで：
- $x = [x_1^T, \ldots, x_n^T]^T$ はスウォーム全体の状態
- $\phi_m: \mathbb{R}^{l_m} \to \mathbb{R}$ と $\psi_{im}: X_i \to \mathbb{R}^{l_m}$ は微分可能な関数
- $M = \{1, \ldots, M\}$ は任意の整数集合

### コンセンサスフィルタ

各ロボット $i \in R$ は、コンセンサスフィルタを用いて $\sum_{j \in R} \psi_{jm}(x_j)$ を近似します：

$$\dot{y}_{im} = k_L \sum_{j \in N_i} (y_{jm} - y_{im}) + \dot{\psi}_{im}(x_i)$$
$$y_{im}(0) = \psi_{im}(x_i(0))$$

ここで、$k_L > 0$ はコンセンサスのゲイン、$N_i$ はロボット $i$ に隣接するロボットの集合です。

### CBFコントローラ

各ロボット $i \in R$ の制御入力は以下の最適化問題の解として得られます：

$$u_i(x_i) \in \arg\min_{u_i} \|u_i - k_i(x_i)\|^2$$
$$\text{s.t.} \sum_{m \in M} \nabla \phi_m(ny_{im})^T \dot{\psi}_{im}(x_i) \geq \alpha \sum_{m \in M} \phi_m(ny_{im})$$

ここで、$k_i(x_i)$ は参照制御入力、$\alpha > 0$ は定数です。

## 4. CCBFの理論的保証

論文では、以下の理論的保証が示されています：

**定理1**: すべての $m \in M$ について $\phi_m$ が凹関数であれば、安全集合 $C \cap B$ はCCBF (15), (16) の下で前方不変です。

**定理2**: $B(x) = \phi(\sum_{i \in R} \psi_i(x_i))$ かつ $\psi_i: X_i \to \mathbb{R}$ の場合、$\phi$ が単調であれば、安全集合 $C \cap B^+$ はCCBF (15), (16) の下で前方不変です。

これらの定理により、CCBFがスウォームの状態を安全集合内に保つことが保証されます。

## 5. CCBFの応用例

論文では、CCBFの応用例として「スウォームとベースステーション間のネットワーク維持」が示されています：

### 「OR」制約

少なくとも1つのロボットがベースステーションと通信できれば、スウォーム全体がマルチホップネットワークを通じてベースステーションからメッセージを受信できるという制約です。

### 確率に関する制約

スウォームとベースステーション間の通信成功率が一定値以上であることを保証する制約です。

## 6. 実験結果

論文では、8台のロボットを用いた実験が行われ、CCBFがローカルな通信のみを用いてスウォーム全体の状態を安全集合内に保つことが示されています。

## 7. 研究テーマへの適用可能性

CCBFは、複数UAVによる協調的なvisual-inertial SLAMシステムにおける視野錐台の交差維持に適用できる可能性があります：

1. **視野錐台交差の制約**: スウォーム全体の状態に依存する制約として、視野錐台の交差を定式化できる
2. **分散制御の実現**: 各UAVが局所的な通信のみを用いて、視野錐台の交差を維持する制御を実現できる
3. **安全性の保証**: 視野錐台の交差維持と衝突回避を同時に保証できる

CCBFは、特徴量の共有視認性（feature co-visibility）を最大化するためのactive perceptionアプローチとして有望であり、研究テーマに適用することで、より効果的な協調的visual-inertial SLAMシステムを実現できる可能性があります。
