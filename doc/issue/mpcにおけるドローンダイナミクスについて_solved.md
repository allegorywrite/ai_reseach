# MPCにおけるドローンダイナミクスについて（解決済み）

## 提起された課題

現在のCCBFの定式化及びその解法には、ドローンのダイナミクスについての記述が見当たりません。状態と入力を最適化問題の中で扱う上では、ドローンのダイナミクスの定式化が必要であると理解していますが、なぜそれに関する記述がないのですか。どのようにCCBF付きMPCが解かれるのかの定式化が不十分です。途中式は一切省かずstep by stepで理論的解析を行ってください。

## 解決策

この課題に対応するため、新しい理論研究ドキュメント「[drone_dynamics_mpc_ccbf.md](../theory/drone_dynamics_mpc_ccbf.md)」を作成しました。このドキュメントでは、CCBF制約付きMPC問題におけるドローンのダイナミクスモデルを明示的に定式化し、最適化問題の解法を詳細に説明しています。

### 主な内容

1. **ドローンのダイナミクスモデル**
   - 状態空間表現（位置、速度、姿勢、角速度を含む完全な状態ベクトル）
   - 詳細なダイナミクス方程式（並進運動と回転運動）
   - 簡略化モデル（計算効率のための線形近似）

2. **CCBF制約付きMPC問題の定式化**
   - 離散時間モデル（連続時間モデルの離散化）
   - 予測ホライズンと制御ホライズン
   - 目的関数（自己位置推定の不確かさ、目標状態への追従誤差、制御入力のエネルギー）
   - CCBF制約（安全性と視野錐台交差を保証）
   - その他の制約（状態と制御入力の境界、衝突回避）
   - 完全なMPC問題の数学的定式化

3. **CCBF制約付きMPC問題の解法**
   - 非線形最適化問題の解法（逐次二次計画法、内点法）
   - 線形化と離散化（ヤコビ行列、オイラー法）
   - CCBF制約の処理（線形化または二次近似）
   - 分散実装（各UAVが自身のMPC問題を解き、情報を交換）
   - 実装上の考慮事項（計算効率、通信遅延、モデル誤差、状態推定）

4. **数値例**
   - パラメータ設定
   - 初期条件
   - シミュレーション結果

### 重要なポイント

1. **ドローンのダイナミクスモデル**：
   ドローンのダイナミクスは、非線形状態空間モデル $\dot{x}_i = f_i(x_i) + g_i(x_i)u_i$ として表現されます。状態ベクトル $x_i$ は位置、速度、姿勢、角速度を含み、制御入力 $u_i$ は推力とモーメントを表します。

2. **MPC問題の定式化**：
   MPC問題は、予測ホライズン $N_p$ にわたる目的関数の最小化問題として定式化されます。目的関数は、自己位置推定の不確かさ、目標状態への追従誤差、制御入力のエネルギーを含みます。

3. **CCBF制約**：
   CCBF制約は、安全性と視野錐台交差を保証するために使用されます。これらの制約は非線形であり、最適化問題を解く際に線形化または二次近似されます。

4. **解法**：
   CCBF制約付きMPC問題は、逐次二次計画法や内点法などの非線形最適化アルゴリズムを用いて解かれます。各反復において、目的関数と制約が線形化または二次近似され、近似問題が解かれます。

## 結論

ドローンのダイナミクスモデルとCCBF制約付きMPC問題の解法について、詳細な理論的解析を行いました。この解析により、CCBF制約付きMPC問題がどのように定式化され、解かれるかが明確になりました。今後の研究では、より複雑なドローンモデルの考慮、外乱やモデル誤差に対するロバスト性の向上、計算効率の改善などが課題となります。
