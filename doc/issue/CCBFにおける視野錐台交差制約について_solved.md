# CCBFにおける視野錐台交差制約に関する検討（解決済み）

## 提起された課題

CCBFにおける視野錐台交差制約について、以下の3つの疑問点が提起されました：

1. 環境内の特徴点（ランドマーク）が複数のUAVによって同時に観測されることを保証したいとあるが、agent 1が観測しているすべての特徴点を他のエージェントが観測することは不可能である。目的はあくまで協調自己位置推定が達成されることで、推定のために十分な特徴点の共有があれば良いはずである。

2. 交差制約を距離と角度のみによって判定しているが、実際にはオクルージョンが存在し、上記の制約が満たされていても視野を共有できていない状況が存在し得るため、距離と角度のみによる制約は完璧とはいえないはずである。オクルージョン平面からの距離を含むような文献もあったはずであるが、ここに関しての深耕は必須であろう。

3. 現在の研究進捗においては目的関数が目標状態誤差と入力のような形式になっているが、上記1の指摘を鑑みれば、そもそも自己位置推定における最適問題に基づいた定式化もあり得るはずである。

## サーベイ結果に基づく回答

サーベイの結果、提起された課題に対して以下の知見が得られました：

### 1. 協調自己位置推定のための十分な特徴点共有の定量化

**既存研究の知見**：
- 複数ロボットの協調SLAMでは、共有される特徴点の数や質が地図統合と相対位置推定精度の鍵を握る
- 「Swarm-SLAM」などの最新システムでは、異なるロボットのマップ間のインタロボットループクローズに共通の特徴点や場所を利用
- 視点差が大きい場合には共有できる視覚特徴が減少し、自己位置推定精度が低下する問題が報告されている
- 共有特徴点の「十分さ」を定義・定量化する指標としては、フィッシャー情報量や共有特徴点数とその視差角度の広がりによる幾何的観測条件が有力

**修正アプローチ**：
- すべての特徴点を共有する必要はなく、協調自己位置推定に必要な「十分な」特徴点共有を定義する
- 共有特徴点の数だけでなく、空間的分散と観測品質を考慮したバリア関数を設計する
- 視野の重複領域の大きさや相対視角の差など、より幾何学的な代理指標を用いることで安定かつ微分可能な制約とする

### 2. オクルージョンを考慮した視野錐台交差制約

**既存研究の知見**：
- Zhouらは視野錐台内に対象を捕捉し続けるための視認性制約を定式化し、遮蔽物によるFoVの欠損を考慮
- 視野集合の符号付距離関数（SDF）をCBFとして利用し、ターゲットが視野境界からどれだけ離れているかを測定
- Weiらは画像ベース視覚制御において、対象物と障害物の画像平面上の投影を凸多角形で近似し、それらが交差しないよう制御する手法を提案
- オクルージョンが発生する寸前の状態を連続的かつ微分可能な形で表現することが重要

**修正アプローチ**：
- 障害物平面からの距離に基づくバリア関数を設計し、視野錐台の交差領域に障害物が入り込まないことを保証
- オクテomapに基づくレイトレーシングや凸近似による手法を導入し、計算効率とのトレードオフを考慮
- 高速な距離計算アルゴリズム（距離地図の事前計算やGPU並列化）を導入することでリアルタイム制御への適用を可能に

### 3. 自己位置推定の不確かさを最小化する目的関数

**既存研究の知見**：
- アクティブSLAM手法では、情報理論に基づいてロボットの将来動作を計画し、予測される地図・自己位置の不確かさを目的関数に組み込む
- MPCを用いて、目標状態への追従誤差と状態推定不確かさの双方をコストに含めてトレードオフを取る手法が一般的
- Leungらの研究では、一歩先を贪欲に最適化する手法よりもNステップ先を見据えて経路最適化するMPC手法の方が、最終的に地図および自己位置の不確かさが小さく抑えられることが確認されている
- 探索（新規領域のカバー）と精度維持（既知領域の再観測）のバランスを動的に考慮できる点が有利

**修正アプローチ**：
- MPCの目的関数に自己位置推定不確かさを直接組み込み、ロボットが目標状態に追従しつつ自身の位置推定精度を維持・向上できるよう設計
- エラー共分散行列の対数行列式（情報エントロピー）を最小化する目的を加えることで、エージェントが自発的に観測の質を高めるような行動を取るよう促す
- 計算コスト削減のため、カルマンフィルタの予測共分散や情報行列の一部（自己位置成分のみや、主要なランドマークに関する部分行列など）を用いる工夫を導入

## 結論

サーベイの結果、提起された課題に対する解決策が明確になりました。提案した定式化は、最新の研究成果と整合しており、理論的に妥当であることが確認されました。ただし、実装上の課題（計算効率、特徴点の動的管理、通信要件など）については引き続き検討が必要です。

今後は、これらの知見を踏まえて、以下の修正を行います：

1. 協調自己位置推定のための十分な特徴点共有を定量化するバリア関数を改良し、フィッシャー情報量や視野重畳率などの指標を組み込む

2. オクルージョンを考慮した視野錐台交差制約を精緻化し、符号付距離関数や凸近似による視認性評価を導入

3. 自己位置推定の不確かさを最小化する目的関数を設計し、MPCフレームワーク内で目標追従と不確かさ低減のバランスを取る

これらの修正により、より現実的な条件下での協調自己位置推定を可能にし、SLAMシステムの性能向上に寄与することが期待されます。
